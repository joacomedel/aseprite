name: Build Aseprite Oficial Logic
on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: 'recursive'

    - name: Install Skia (Official Script Method)
      shell: bash
      run: |
        # Usamos el script interno de Aseprite para obtener la URL correcta
        skia_url=$(source laf/misc/skia-url.sh | xargs)
        curl -L -o skia.zip "$skia_url"
        7z x skia.zip -oskia

    - uses: aseprite/get-ninja@main
    - uses: ilammy/msvc-dev-cmd@v1

    - name: Generating Makefiles
      shell: bash
      run: |
        # Esta configuraci√≥n es la que usa el equipo de Aseprite en sus servidores
        cmake -S . -B build -G Ninja \
          -DCMAKE_BUILD_TYPE=RelWithDebInfo \
          -DLAF_BACKEND=skia \
          -DSKIA_DIR=$(realpath skia) \
          -DSKIA_LIBRARY_DIR=$(realpath skia/out/Release-x64) \
          -DENABLE_UPDATER=OFF

    - name: Compiling
      shell: bash
      run: |
        cd build && ninja aseprite

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: aseprite-build-oficial
        path: build/bin/aseprite.exe
